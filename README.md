# CompleteSeries
In matlab, read an image, that follows a template, extract the serie in it and write the followings numbers.

In this project the objective was to read a series of framed numbers, find out the series and complete it according to the given frames and its rotation. The first thing that is done in the code is to detect if the image is rotated, but as it was the last thing to be implemented we will leave it for the end. 
Next is the detection of the frames to know where to read and where to write later.
For greater manageability it has been implemented in the function getSquares that receives the original image, the treatment that is made inside the function is very simple, after converting it into a binary image we cover the closed holes that have the numbers, as it can be the 0, or the 4, so that there are no problems when detecting the boxes. This has been done with the help of bwareaopen, detecting the connected components and eliminating the smallest ones. Finally we remove the first box obtained as it is the frame of the entire image in all cases. 

After this we have to do the number detection. At first the idea was to do it by correlation but it requires much more preprocessing and less maneuverable than using the ocr function which is what I have finally implemented. First we need the image in binary format and complemented (with white numbers and black background). Then we look for the connected components to be able to differentiate the numbers of the rest, the numbers will be the smallest so the rest we put them to 0, that is to say, to black. Once we have only the numbers and we have all the boxes, we will look for the results there. As we pass even the empty cells to the ocr function, after obtaining the results we save the values, eliminating also the blanks that have been calculated.
The next step occurs in getSeries, where we get the next values of the numerical series. First it verifies if the difference between the values that we already have, that are those that we passed by parameter, is constant or not, if it is it we will only have to continue adding as many times as spaces are left, that at the most are 10 since all use the same template. if it is not constant we check that the difference between the values is not symmetric, if it is then it follows a pattern that continues in the second element of the difference since the first one that we obtain already "has been used", in fact it is the last one but being symmetric we do not care, we will follow the sum according to this pattern. If it was none of the previous ones then obviously it is fibonacci, we complete the series and we return the vector with the numbers. 
The last step would be to write the text in the grid using the text and set function. This procedure does not have much to explain other than that we will write in the boxes whether the image is rotated or not. To explain it let's first see how to rotate the image.
We use the Hough transform that among others allows us to see the angle of inclination of the lines, with respect to the X axis, that we find looking for the peaks of the function. If the tilt is small, it is convenient not to touch the image because when we rotate it we lose quality and the numbers are more difficult to identify, but of course, if it is too large we must return it to horizontal using \textit{imrotate} and applying a sum of 90 or -90 degrees depending on the side to which the image is tilted because the axis that is taken into account when calculating the angle is not the one we are interested in. Then we have to apply dilation and erosion to the image because of the loss of quality mentioned before, although, honestly, it does not improve the results much although the image looks apparently better. The rotation is important to apply it because if it is not applied, even if the boxes are well taken, ocr would read the numbers with an inclination that makes it fail a lot, so we have to put it horizontally. Before rotating it we calculate the boxes so that we can use them when writing text in the original image. If the image is rotated then we will use these rotated boxes as a reference for typing.
